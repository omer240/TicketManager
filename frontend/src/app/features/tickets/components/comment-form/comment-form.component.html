<div class="comment-form-container">
  <form [formGroup]="commentForm" (ngSubmit)="onSubmit()">
    <div class="form-header">
      <h3>{{ isEditMode ? 'Edit Comment' : 'Add Comment' }}</h3>
      @if (isEditMode) {
        <button type="button" class="cancel-edit-btn" (click)="onCancel()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Cancel
        </button>
      }
    </div>

    <div class="form-group">
      <textarea
        id="text"
        formControlName="text"
        rows="4"
        placeholder="Write your comment..."
        [class.error]="text?.invalid && text?.touched"
      ></textarea>
      
      <div class="field-footer">
        <div class="character-count" [class.limit-warning]="characterCount > 1800">
          {{ characterCount }} / 2000
        </div>
        
        @if (text?.invalid && text?.touched) {
          <div class="error-message">
            @if (text?.errors?.['required']) {
              <span>Comment text is required</span>
            }
            @if (text?.errors?.['maxlength']) {
              <span>Comment cannot exceed 2000 characters</span>
            }
          </div>
        }
      </div>
    </div>

    <div class="form-actions">
      @if (isEditMode) {
        <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="isSubmitting">
          Cancel
        </button>
      }
      <button type="submit" class="btn btn-primary" [disabled]="isSubmitting || commentForm.invalid">
        @if (isSubmitting) {
          <span class="spinner"></span>
          {{ isEditMode ? 'Updating...' : 'Posting...' }}
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"/>
            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
          {{ isEditMode ? 'Update Comment' : 'Post Comment' }}
        }
      </button>
    </div>
  </form>
</div>
