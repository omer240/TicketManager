<div class="ticket-create-container">
  <div class="create-card">
    <div class="header">
      <button class="btn-back" (click)="goBack()">
        ← Listeye Dön
      </button>
      <h1>Yeni Talep Oluştur</h1>
    </div>

    @if (errorMessage) {
      <div class="alert alert-error">
        {{ errorMessage }}
      </div>
    }

    <form [formGroup]="createForm" (ngSubmit)="onSubmit()" class="create-form">
      <div class="form-group">
        <label for="title">Başlık *</label>
        <input 
          id="title"
          type="text" 
          formControlName="title"
          placeholder="Talep başlığını girin"
          [class.invalid]="title?.invalid && title?.touched"
        />
        @if (title?.invalid && title?.touched) {
          <div class="error-text">
            @if (title?.errors?.['required']) {
              <span>Başlık gereklidir</span>
            }
            @if (title?.errors?.['maxlength']) {
              <span>Başlık 200 karakteri geçmemelidir</span>
            }
          </div>
        }
      </div>

      <div class="form-group">
        <label for="description">Açıklama *</label>
        <textarea 
          id="description"
          formControlName="description"
          rows="8"
          placeholder="Talep açıklamasını detaylı olarak girin..."
          [class.invalid]="description?.invalid && description?.touched"
        ></textarea>
        @if (description?.invalid && description?.touched) {
          <div class="error-text">
            @if (description?.errors?.['required']) {
              <span>Açıklama gereklidir</span>
            }
            @if (description?.errors?.['maxlength']) {
              <span>Açıklama 2000 karakteri geçmemelidir</span>
            }
          </div>
        }
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="priority">Öncelik *</label>
          <select id="priority" formControlName="priority">
            @for (option of priorityOptions; track option.value) {
              <option [ngValue]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>
      </div>

      <div class="form-group">
        <app-user-select
          formControlName="assignedToUserId"
          label="Atanan Kişi"
          placeholder="Kullanıcı arayın ve seçin..."
          [required]="true">
        </app-user-select>
        @if (assignedToUserId?.invalid && assignedToUserId?.touched) {
          <div class="error-text">
            <span>Lütfen bu talebi atamak için bir kullanıcı seçin</span>
          </div>
        }
      </div>

      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn-secondary" 
          (click)="goBack()"
          [disabled]="isSubmitting">
          İptal
        </button>
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="isSubmitting">
          {{ isSubmitting ? 'Oluşturuluyor...' : 'Talep Oluştur' }}
        </button>
      </div>
    </form>
  </div>
</div>
